<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>元旦快乐 | 新年祝福</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#000000">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            background-color: #000;
            font-family: "Microsoft YaHei", "PingFang SC", "Helvetica Neue", Arial, sans-serif;
            touch-action: manipulation;
        }
        
        /* 微信提示 */
        .weixin-tip {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #fff;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .weixin-tip.show {
            opacity: 1;
            visibility: visible;
        }
        
        .weixin-tip img {
            width: 150px;
            height: 150px;
            margin-bottom: 20px;
        }
        
        .weixin-tip p {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 10px;
            color: #ff9800;
        }
        
        /* 烟花画布容器 */
        #fireworks-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* 艺术字容器 */
        .art-text-container {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 1200px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
            margin: 0 auto;
        }
        
        /* 主标题 */
        .main-title {
            font-size: clamp(3rem, 8vw, 6.5rem);
            font-weight: 900;
            text-align: center;
            line-height: 1.1;
            margin-bottom: 0.8rem;
            background: linear-gradient(to bottom, #ffeb3b, #ff9800, #f44336);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 
                0 0 15px rgba(255, 87, 34, 0.8),
                0 0 30px rgba(255, 193, 7, 0.6),
                0 0 45px rgba(255, 87, 34, 0.4);
            letter-spacing: 2px;
            position: relative;
            animation: glow 3s ease-in-out infinite alternate;
            padding: 8px 15px;
            will-change: transform, text-shadow;
        }
        
        /* 元旦快乐四个字的单独样式 */
        .char-yuan {
            display: inline-block;
            transform: rotate(-5deg);
            text-shadow: 
                0 0 20px #ff5722,
                0 0 40px #ff9800,
                0 0 60px #ffeb3b;
        }
        
        .char-dan {
            display: inline-block;
            transform: scale(1.1);
            text-shadow: 
                0 0 20px #ff9800,
                0 0 40px #ff5722,
                0 0 60px #f44336;
        }
        
        .char-kuai {
            display: inline-block;
            transform: rotate(3deg);
            text-shadow: 
                0 0 20px #4caf50,
                0 0 40px #8bc34a,
                0 0 60px #cddc39;
        }
        
        .char-le {
            display: inline-block;
            transform: scale(1.05) rotate(-2deg);
            text-shadow: 
                0 0 20px #2196f3,
                0 0 40px #03a9f4,
                0 0 60px #00bcd4;
        }
        
        /* 副标题 */
        .subtitle {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: #fff;
            text-align: center;
            margin-bottom: 1.5rem;
            text-shadow: 
                0 0 10px #ff9800,
                0 0 20px #ff5722;
            letter-spacing: 1px;
            animation: pulse 2s ease-in-out infinite alternate;
            position: relative;
            padding: 5px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            backdrop-filter: blur(5px);
            will-change: transform, opacity;
        }
        
        /* 装饰元素 */
        .decoration {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .decoration-item {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #ff9800, #ff5722);
            border-radius: 50%;
            position: relative;
            animation: float 4s ease-in-out infinite;
            box-shadow: 
                0 0 15px #ff9800,
                0 0 30px #ff5722;
            will-change: transform;
        }
        
        .decoration-item:nth-child(2) {
            animation-delay: 0.5s;
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            box-shadow: 
                0 0 15px #4caf50,
                0 0 30px #8bc34a;
        }
        
        .decoration-item:nth-child(3) {
            animation-delay: 1s;
            background: linear-gradient(45deg, #2196f3, #03a9f4);
            box-shadow: 
                0 0 15px #2196f3,
                0 0 30px #03a9f4;
        }
        
        .decoration-item:nth-child(4) {
            animation-delay: 1.5s;
            background: linear-gradient(45deg, #9c27b0, #e91e63);
            box-shadow: 
                0 0 15px #9c27b0,
                0 0 30px #e91e63;
        }
        
        /* 发光边框效果 */
        .main-title::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #ff5722, #ff9800, #ffeb3b, #4caf50, #2196f3, #9c27b0);
            background-size: 400% 400%;
            border-radius: 12px;
            z-index: -1;
            filter: blur(15px);
            opacity: 0.6;
            animation: border-glow 6s ease infinite;
        }
        
        /* 雪花装饰 */
        .snowflake {
            position: absolute;
            color: #fff;
            font-size: 1.2rem;
            opacity: 0.7;
            animation: fall linear infinite;
            z-index: 5;
            pointer-events: none;
        }
        
        /* 动画定义 */
        @keyframes glow {
            0% {
                text-shadow: 
                    0 0 15px rgba(255, 87, 34, 0.8),
                    0 0 30px rgba(255, 193, 7, 0.6),
                    0 0 45px rgba(255, 87, 34, 0.4);
                transform: scale(1);
            }
            100% {
                text-shadow: 
                    0 0 20px rgba(255, 87, 34, 1),
                    0 0 40px rgba(255, 193, 7, 0.8),
                    0 0 60px rgba(255, 87, 34, 0.6);
                transform: scale(1.02);
            }
        }
        
        @keyframes pulse {
            0% {
                opacity: 0.8;
                transform: translateY(0);
            }
            100% {
                opacity: 1;
                transform: translateY(-3px);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-15px) rotate(180deg);
            }
        }
        
        @keyframes border-glow {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        /* 新年倒计时 */
        .countdown {
            color: #fff;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            text-align: center;
            margin-top: 20px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 15px rgba(255, 87, 34, 0.3);
            width: 90%;
            max-width: 500px;
        }
        
        .countdown-numbers {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
        }
        
        .countdown-item {
            background: linear-gradient(to bottom, #ff5722, #ff9800);
            padding: 8px 12px;
            border-radius: 8px;
            min-width: 60px;
            font-weight: bold;
            font-size: clamp(1.6rem, 4vw, 2.2rem);
            box-shadow: 0 0 12px rgba(255, 87, 34, 0.7);
            text-align: center;
        }
        
        .countdown-label {
            font-size: 0.9rem;
            margin-top: 4px;
            opacity: 0.8;
        }
        
        /* 音乐控制按钮 */
        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            cursor: pointer;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }
        
        .music-control:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.25);
        }
        
        .music-control i {
            font-size: 24px;
            color: #ff9800;
            text-shadow: 0 0 10px rgba(255, 152, 0, 0.7);
        }
        
        /* 分享按钮 */
        .share-btn {
            position: fixed;
            top: 85px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            cursor: pointer;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }
        
        .share-btn:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.25);
        }
        
        .share-btn i {
            font-size: 22px;
            color: #4caf50;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
        }
        
        /* 趴菜水印样式 */
        .watermark {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.3);
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            font-weight: bold;
            font-family: "Microsoft YaHei", "SimHei", "KaiTi", cursive;
            z-index: 50;
            pointer-events: none;
            text-shadow: 
                1px 1px 0 rgba(0, 0, 0, 0.3);
            transform: rotate(-5deg);
            animation: watermark-drift 25s ease-in-out infinite alternate;
            padding: 6px 12px;
            background: linear-gradient(45deg, 
                rgba(255, 255, 255, 0.05), 
                rgba(255, 255, 255, 0.02));
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(3px);
        }
        
        @keyframes watermark-drift {
            0%, 100% {
                transform: rotate(-5deg) translateY(0);
            }
            25% {
                transform: rotate(-4deg) translateY(-3px);
            }
            50% {
                transform: rotate(-6deg) translateY(2px);
            }
            75% {
                transform: rotate(-5.5deg) translateY(-1px);
            }
        }
        
        /* 微信引导分享提示 */
        .share-guide {
            position: fixed;
            top: 0;
            right: 0;
            width: 200px;
            height: 150px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="150"><path d="M200 0 L200 150 L150 150 L150 50 L50 50 L50 150 L0 150 L0 0 Z" fill="rgba(0,0,0,0.8)" stroke="%23ff9800" stroke-width="2"/><text x="100" y="90" font-family="Arial" font-size="14" fill="%23ff9800" text-anchor="middle">点击分享给好友</text></svg>');
            z-index: 1000;
            display: none;
            pointer-events: none;
        }
        
        .share-guide.show {
            display: block;
            animation: fadeInOut 3s ease-in-out;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            10%, 90% { opacity: 1; }
        }
        
        /* 加载动画 */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #ff9800;
            font-size: 1.2rem;
            transition: opacity 0.5s ease;
        }
        
        .loading.hide {
            opacity: 0;
            pointer-events: none;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 152, 0, 0.3);
            border-top-color: #ff9800;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .music-control, .share-btn {
                width: 45px;
                height: 45px;
                top: 15px;
                right: 15px;
            }
            
            .share-btn {
                top: 75px;
            }
            
            .music-control i, .share-btn i {
                font-size: 20px;
            }
            
            .decoration-item {
                width: 40px;
                height: 40px;
            }
            
            .watermark {
                bottom: 15px;
                right: 15px;
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 480px) {
            .art-text-container {
                padding: 10px;
            }
            
            .main-title {
                letter-spacing: 1px;
                padding: 5px 10px;
            }
            
            .subtitle {
                padding: 4px 10px;
            }
            
            .countdown {
                padding: 10px 15px;
            }
            
            .countdown-item {
                min-width: 50px;
                padding: 6px 10px;
            }
            
            .decoration {
                gap: 15px;
            }
            
            .decoration-item {
                width: 35px;
                height: 35px;
            }
            
            .music-control, .share-btn {
                width: 40px;
                height: 40px;
                top: 10px;
                right: 10px;
            }
            
            .share-btn {
                top: 65px;
            }
            
            .music-control i, .share-btn i {
                font-size: 18px;
            }
        }
        
        /* 防止iOS橡皮筋效果 */
        body {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        /* 优化长按菜单 */
        .art-text-container, .main-title, .subtitle, .countdown {
            -webkit-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <!-- 加载动画 -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>加载元旦祝福中...</div>
    </div>
    
    <!-- 微信提示 -->
    <div class="weixin-tip" id="weixinTip">
        <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='150' height='150'><path fill='%23ff9800' d='M17.5,1.5c-1.5,0-2.5,1-2.5,2.5c0,0.6,0.2,1.2,0.6,1.6l-1.2,1.2c-0.4-0.4-1-0.6-1.6-0.6c-1.5,0-2.5,1-2.5,2.5 c0,0.6,0.2,1.2,0.6,1.6l-4.2,4.2c-0.4-0.4-1-0.6-1.6-0.6c-1.5,0-2.5,1-2.5,2.5s1,2.5,2.5,2.5s2.5-1,2.5-2.5 c0-0.6-0.2-1.2-0.6-1.6l4.2-4.2c0.4,0.4,1,0.6,1.6,0.6c1.5,0,2.5-1,2.5-2.5c0-0.6-0.2-1.2-0.6-1.6l1.2-1.2c0.4,0.4,1,0.6,1.6,0.6 c1.5,0,2.5-1,2.5-2.5S19,1.5,17.5,1.5z'/></svg>" alt="音乐提示">
        <p>请点击右上角"..."</p>
        <p>选择"在浏览器中打开"</p>
        <p>以获得最佳体验和音乐效果</p>
    </div>
    
    <!-- 烟花画布 -->
    <canvas id="fireworks-container"></canvas>
    
    <!-- 艺术字内容 -->
    <div class="art-text-container">
        <h1 class="main-title">
            <span class="char-yuan">元</span>
            <span class="char-dan">旦</span>
            <span class="char-kuai">快</span>
            <span class="char-le">乐</span>
        </h1>
        
        <h2 class="subtitle">新年新气象 · 好运伴你行</h2>
        
        <!-- 新年倒计时 -->
        <div class="countdown">
            <div>新年倒计时</div>
            <div class="countdown-numbers">
                <div>
                    <div id="countdown-hours" class="countdown-item">00</div>
                    <div class="countdown-label">时</div>
                </div>
                <div>
                    <div id="countdown-minutes" class="countdown-item">00</div>
                    <div class="countdown-label">分</div>
                </div>
                <div>
                    <div id="countdown-seconds" class="countdown-item">00</div>
                    <div class="countdown-label">秒</div>
                </div>
            </div>
        </div>
        
        <!-- 装饰元素 -->
        <div class="decoration">
            <div class="decoration-item"></div>
            <div class="decoration-item"></div>
            <div class="decoration-item"></div>
            <div class="decoration-item"></div>
        </div>
    </div>
    
    <!-- 音乐控制按钮 -->
    <div class="music-control" id="musicControl">
        <i class="fas fa-volume-mute"></i>
    </div>
    
    <!-- 分享按钮 -->
    <div class="share-btn" id="shareBtn" title="分享给好友">
        <i class="fas fa-share-alt"></i>
    </div>
    
    <!-- 微信引导分享提示 -->
    <div class="share-guide" id="shareGuide"></div>
    
    <!-- 趴菜水印 -->
    <div class="watermark">趴菜</div>
    
    <!-- 背景音乐 -->
    <audio id="bg-music" loop preload="auto">
        <source src="https://music.163.com/song/media/outer/url?id=2050954543.mp3" type="audio/mpeg">
        <source src="https://cdn.pixabay.com/download/audio/2021/10/25/audio_d5d5e2d3a2.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // 检测微信浏览器
        function isWeixinBrowser() {
            return /MicroMessenger/i.test(navigator.userAgent);
        }
        
        // 显示微信提示
        function showWeixinTip() {
            if (isWeixinBrowser()) {
                const tip = document.getElementById('weixinTip');
                tip.classList.add('show');
                
                // 5秒后自动隐藏
                setTimeout(() => {
                    tip.classList.remove('show');
                }, 5000);
            }
        }
        
        // 页面加载完成
        window.addEventListener('load', function() {
            const loading = document.getElementById('loading');
            
            // 隐藏加载动画
            setTimeout(() => {
                loading.classList.add('hide');
                
                // 完全移除加载动画
                setTimeout(() => {
                    loading.style.display = 'none';
                }, 500);
            }, 1500);
            
            // 显示微信提示（如果是微信浏览器）
            setTimeout(showWeixinTip, 2000);
            
            // 初始化页面
            initPage();
        });
        
        // 烟花效果实现
        const canvas = document.getElementById('fireworks-container');
        const ctx = canvas.getContext('2d');
        
        // 设置画布尺寸
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        resizeCanvas();
        
        // 优化resize事件
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(resizeCanvas, 250);
        });
        
        // 烟花粒子类
        class Particle {
            constructor(x, y, color, velocity) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.velocity = velocity;
                this.alpha = 1;
                this.gravity = 0.01;
                this.friction = 0.99;
                this.size = Math.random() * 2 + 0.5; // 减小粒子大小
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }
            
            update() {
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                this.velocity.y += this.gravity;
                
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                
                this.alpha -= 0.008;
                
                this.draw();
            }
        }
        
        // 烟花类
        class Firework {
            constructor(x, y, targetX, targetY) {
                this.x = x;
                this.y = y;
                this.targetX = targetX;
                this.targetY = targetY;
                this.distanceToTarget = Math.hypot(targetX - x, targetY - y);
                this.distanceTraveled = 0;
                
                this.trail = [];
                this.angle = Math.atan2(targetY - y, targetX - x);
                this.speed = 8; // 降低速度
                this.acceleration = 1.04; // 降低加速度
                this.brightness = Math.random() * 50 + 50;
                this.targetRadius = 1;
                
                // 随机颜色
                const hue = Math.floor(Math.random() * 360);
                this.color = `hsl(${hue}, 100%, ${this.brightness}%)`;
            }
            
            update(index) {
                // 移除已经爆炸的烟花
                if (this.targetRadius < 6) {
                    this.targetRadius += 0.25;
                } else {
                    this.explode();
                    fireworks.splice(index, 1);
                }
                
                // 移动轨迹
                this.speed *= this.acceleration;
                
                const velocity = {
                    x: Math.cos(this.angle) * this.speed,
                    y: Math.sin(this.angle) * this.speed
                };
                
                this.distanceTraveled = Math.hypot(velocity.x, velocity.y);
                
                this.x += velocity.x;
                this.y += velocity.y;
                
                // 绘制轨迹
                this.trail.push([this.x, this.y]);
                if (this.trail.length > 3) { // 减少轨迹长度
                    this.trail.shift();
                }
                
                // 绘制烟花
                ctx.save();
                ctx.globalAlpha = 0.7;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.targetRadius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                
                // 绘制轨迹
                if (this.trail.length > 1) {
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0][0], this.trail[0][1]);
                    for (let i = 1; i < this.trail.length; i++) {
                        ctx.lineTo(this.trail[i][0], this.trail[i][1]);
                    }
                    ctx.strokeStyle = this.color;
                    ctx.lineWidth = 1.5; // 减小线宽
                    ctx.stroke();
                }
                ctx.restore();
            }
            
            explode() {
                const particleCount = 80; // 减少粒子数量
                const power = 8; // 减小爆炸威力
                
                for (let i = 0; i < particleCount; i++) {
                    const velocity = {
                        x: Math.random() * power - power / 2,
                        y: Math.random() * power - power / 2
                    };
                    
                    particles.push(new Particle(this.x, this.y, this.color, velocity));
                }
            }
        }
        
        // 存储烟花和粒子
        let fireworks = [];
        let particles = [];
        let animationId = null;
        let fireworkInterval = null;
        
        // 创建随机烟花
        function createFirework() {
            const x = Math.random() * canvas.width;
            const y = canvas.height;
            const targetX = Math.random() * canvas.width;
            const targetY = Math.random() * (canvas.height / 2);
            
            fireworks.push(new Firework(x, y, targetX, targetY));
        }
        
        // 创建心形烟花
        function createHeartFirework() {
            const x = canvas.width / 2;
            const y = canvas.height;
            const targetX = canvas.width / 2;
            const targetY = canvas.height / 3;
            
            const firework = new Firework(x, y, targetX, targetY);
            firework.explode = function() {
                const particleCount = 120; // 减少数量
                
                for (let i = 0; i < particleCount; i++) {
                    const angle = (i / particleCount) * Math.PI * 2;
                    
                    // 心形曲线方程
                    const heartX = 16 * Math.pow(Math.sin(angle), 3);
                    const heartY = -(13 * Math.cos(angle) - 5 * Math.cos(2 * angle) - 2 * Math.cos(3 * angle) - Math.cos(4 * angle));
                    
                    const scale = 3; // 减小缩放
                    const velocity = {
                        x: heartX * scale / 50,
                        y: heartY * scale / 50
                    };
                    
                    particles.push(new Particle(this.x, this.y, this.color, velocity));
                }
            };
            
            fireworks.push(firework);
        }
        
        // 动画循环
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // 半透明黑色背景，制造拖尾效果
            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)'; // 增加透明度
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 更新并绘制所有粒子
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                
                if (particles[i].alpha <= 0) {
                    particles.splice(i, 1);
                }
            }
            
            // 更新并绘制所有烟花
            for (let i = fireworks.length - 1; i >= 0; i--) {
                fireworks[i].update(i);
            }
            
            // 随机创建雪花
            if (Math.random() < 0.015) { // 减少雪花生成概率
                createSnowflake();
            }
        }
        
        // 启动烟花动画
        function startFireworks() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            // 启动动画循环
            animate();
            
            // 启动自动创建烟花
            if (fireworkInterval) {
                clearInterval(fireworkInterval);
            }
            
            // 根据设备性能调整烟花频率
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const intervalTime = isMobile ? 800 : 500;
            
            fireworkInterval = setInterval(() => {
                if (Math.random() < 0.5) { // 降低烟花生成概率
                    createFirework();
                }
                
                // 偶尔创建特殊烟花
                if (Math.random() < 0.05) {
                    createHeartFirework();
                }
            }, intervalTime);
        }
        
        // 停止烟花动画
        function stopFireworks() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            if (fireworkInterval) {
                clearInterval(fireworkInterval);
                fireworkInterval = null;
            }
        }
        
        // 点击创建烟花
        canvas.addEventListener('click', (e) => {
            const x = e.clientX;
            const y = e.clientY;
            
            const firework = new Firework(canvas.width / 2, canvas.height, x, y);
            fireworks.push(firework);
            
            // 点击后尝试播放音乐（微信需要用户交互）
            playBackgroundMusic();
        });
        
        // 触摸事件（移动端）
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const x = touch.clientX;
            const y = touch.clientY;
            
            const firework = new Firework(canvas.width / 2, canvas.height, x, y);
            fireworks.push(firework);
            
            // 触摸后尝试播放音乐
            playBackgroundMusic();
        }, { passive: false });
        
        // 创建雪花
        function createSnowflake() {
            const snowflake = document.createElement('div');
            snowflake.className = 'snowflake';
            snowflake.innerHTML = '❄';
            snowflake.style.left = Math.random() * 100 + 'vw';
            snowflake.style.fontSize = Math.random() * 8 + 8 + 'px'; // 减小雪花大小
            snowflake.style.animationDuration = Math.random() * 4 + 4 + 's';
            snowflake.style.animationDelay = Math.random() * 5 + 's';
            
            document.body.appendChild(snowflake);
            
            // 移除雪花
            setTimeout(() => {
                if (snowflake.parentNode) {
                    snowflake.remove();
                }
            }, 8000); // 减少存在时间
        }
        
        // 新年倒计时
        function updateCountdown() {
            const now = new Date();
            const newYear = new Date(now.getFullYear() + 1, 0, 1); // 下一年的1月1日
            
            // 如果已经是新的一年，则计算下一年
            if (now.getMonth() === 0 && now.getDate() === 1) {
                newYear.setFullYear(now.getFullYear());
            }
            
            const diff = newYear - now;
            
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('countdown-hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('countdown-minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('countdown-seconds').textContent = String(seconds).padStart(2, '0');
        }
        
        // 更新倒计时
        setInterval(updateCountdown, 1000);
        updateCountdown();
        
        // 背景音乐控制
        const bgMusic = document.getElementById('bg-music');
        const musicControl = document.getElementById('musicControl');
        let musicPlaying = false;
        
        // 播放背景音乐
        function playBackgroundMusic() {
            if (bgMusic.paused && !musicPlaying) {
                bgMusic.volume = 0.3; // 降低音量
                bgMusic.play()
                    .then(() => {
                        musicPlaying = true;
                        musicControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                        localStorage.setItem('musicAutoPlay', 'true');
                    })
                    .catch(e => {
                        console.log("音乐播放失败:", e);
                        // 显示提示让用户手动点击播放
                        musicControl.style.background = 'rgba(255, 87, 34, 0.3)';
                    });
            }
        }
        
        // 音乐控制按钮点击事件
        musicControl.addEventListener('click', function() {
            if (bgMusic.paused) {
                bgMusic.volume = 0.3;
                bgMusic.play()
                    .then(() => {
                        musicPlaying = true;
                        this.innerHTML = '<i class="fas fa-volume-up"></i>';
                        localStorage.setItem('musicAutoPlay', 'true');
                    })
                    .catch(e => {
                        console.log("音乐播放失败:", e);
                        if (isWeixinBrowser()) {
                            showWeixinTip();
                        }
                    });
            } else {
                bgMusic.pause();
                musicPlaying = false;
                this.innerHTML = '<i class="fas fa-volume-mute"></i>';
                localStorage.setItem('musicAutoPlay', 'false');
            }
        });
        
        // 分享功能
        const shareBtn = document.getElementById('shareBtn');
        const shareGuide = document.getElementById('shareGuide');
        
        shareBtn.addEventListener('click', function() {
            // 显示分享引导
            shareGuide.classList.add('show');
            setTimeout(() => {
                shareGuide.classList.remove('show');
            }, 3000);
            
            // 尝试调用微信分享API
            if (typeof WeixinJSBridge !== 'undefined') {
                WeixinJSBridge.invoke('shareTimeline', {
                    'img_url': 'https://cdn.pixabay.com/photo/2016/11/21/16/02/fireworks-1846140_1280.jpg',
                    'link': window.location.href,
                    'desc': '元旦快乐！快来接收这份特别的新年祝福！',
                    'title': '元旦快乐烟花祝福'
                });
            }
            
            // 复制链接到剪贴板
            const textArea = document.createElement('textarea');
            textArea.value = window.location.href;
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    // 简单提示
                    const originalHTML = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-check"></i>';
                    setTimeout(() => {
                        this.innerHTML = originalHTML;
                    }, 1000);
                }
            } catch (err) {
                console.log('复制失败:', err);
            }
            
            document.body.removeChild(textArea);
        });
        
        // 初始化页面
        function initPage() {
            // 启动烟花效果
            startFireworks();
            
            // 检查是否自动播放音乐
            const shouldAutoPlay = localStorage.getItem('musicAutoPlay') !== 'false';
            if (shouldAutoPlay) {
                // 延迟尝试播放音乐
                setTimeout(() => {
                    playBackgroundMusic();
                }, 1000);
            }
            
            // 监听页面可见性变化
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    // 页面隐藏时暂停音乐
                    if (!bgMusic.paused) {
                        bgMusic.pause();
                    }
                } else {
                    // 页面显示时恢复音乐
                    if (musicPlaying && bgMusic.paused) {
                        bgMusic.play().catch(e => console.log("恢复播放失败"));
                    }
                }
            });
            
            // 防止页面滚动
            document.addEventListener('touchmove', function(e) {
                if (e.target.tagName !== 'CANVAS') {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // 防止双击放大
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(e) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, { passive: false });
        }
        
        // 页面卸载时清理
        window.addEventListener('beforeunload', function() {
            stopFireworks();
            if (!bgMusic.paused) {
                bgMusic.pause();
            }
        });
    </script>
</body>
</html>
